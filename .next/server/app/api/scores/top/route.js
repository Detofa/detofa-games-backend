(()=>{var e={};e.id=3931,e.ids=[3931],e.modules={1693:(e,r,t)=>{"use strict";t.d(r,{W:()=>n});var s=t(43205),o=t.n(s);let a=process.env.JWT_SECRET;function n(e){let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return null;let t=r.split(" ")[1];try{return o().verify(t,a).userId}catch(e){return console.error("JWT verification failed:",e),null}}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11486:(e,r,t)=>{"use strict";t.d(r,{D:()=>o});var s=t(88605);function o(e,r){let t=(0,s.a)(e,r?.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}},12651:(e,r,t)=>{"use strict";t.d(r,{k:()=>a});let s={};var o=t(88605);function a(e,r){let t=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0,a=(0,o.a)(e,r?.in),n=a.getDay();return a.setDate(a.getDate()-(7*(n<t)+n-t)),a.setHours(0,0,0,0),a}},27910:e=>{"use strict";e.exports=require("stream")},27937:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>k,serverHooks:()=>h,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>m});var o=t(96559),a=t(48088),n=t(37719),u=t(32190),i=t(96330),c=t(45455),l=t(66445),p=t(12651),d=t(43689),f=t(11486),x=t(1693);let v=i.Prisma.validator()({user:{select:{id:!0,name:!0}}});async function m(e){try{let r=(0,x.W)(e);if(!r)return u.NextResponse.json({error:"Unauthorized"},{status:401});let{gameName:t,filter:s}=await e.json();if(!t)return u.NextResponse.json({error:"gameName is required in the request body"},{status:400});let o=null,a=new Date;switch(s){case"Day":o=(0,l.o)(a);break;case"Week":o=(0,p.k)(a,{weekStartsOn:1});break;case"Month":o=(0,d.w)(a);break;case"Year":o=(0,f.D)(a);break;default:o=null}let n=await c.A.score.findMany({where:{game:t,...o?{createdAt:{gte:o}}:{}},include:v}),i=Object.values(n.reduce((e,r)=>{let t=r.user.id;return(!e[t]||r.score>e[t].score)&&(e[t]=r),e},{})).sort((e,r)=>r.score-e.score).slice(0,10).map(e=>({user:e.user.id===r?e.user.name:e.user.id.substring(0,5),score:e.score}));return u.NextResponse.json(i,{status:200})}catch(e){return console.error("Error in /scores/top:",e),u.NextResponse.json({error:"Internal Server Error"},{status:500})}}let k=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/scores/top/route",pathname:"/api/scores/top",filename:"route",bundlePath:"app/api/scores/top/route"},resolvedPagePath:"D:\\Detofa\\Game\\detofa-games-backend\\src\\app\\api\\scores\\top\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:g,serverHooks:h}=k;function y(){return(0,n.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:g})}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43689:(e,r,t)=>{"use strict";t.d(r,{w:()=>o});var s=t(88605);function o(e,r){let t=(0,s.a)(e,r?.in);return t.setDate(1),t.setHours(0,0,0,0),t}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45455:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=new(t(96330)).PrismaClient},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66445:(e,r,t)=>{"use strict";t.d(r,{o:()=>o});var s=t(88605);function o(e,r){let t=(0,s.a)(e,r?.in);return t.setHours(0,0,0,0),t}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},88605:(e,r,t)=>{"use strict";t.d(r,{a:()=>o});let s=Symbol.for("constructDateFrom");function o(e,r){var t;return t=r||e,"function"==typeof t?t(e):t&&"object"==typeof t&&s in t?t[s](e):t instanceof Date?new t.constructor(e):new Date(e)}},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,3205],()=>t(27937));module.exports=s})();